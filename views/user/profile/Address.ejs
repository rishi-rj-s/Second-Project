<%- include('../../partials/userHeader') %>

    <head>
        <style>
            .gradient-custom {
                /* fallback for old browsers */
                background: #f6d365;

                /* Chrome 10-25, Safari 5.1-6 */
                background: -webkit-linear-gradient(to right bottom, rgba(246, 211, 101, 1), rgba(253, 160, 133, 1));

                /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
                background: linear-gradient(to right bottom, rgba(246, 211, 101, 1), rgba(253, 160, 133, 1))
            }

            h6 {
                margin-top: 50px;
            }
        </style>
    </head>

    <div class="bg-primary">
        <div class="container py-4">
            <!-- Breadcrumb -->
            <nav class="d-flex">
                <h5 class="mb-0">
                    <a href="/" class="text-white-50">Home</a>
                    <span class="text-white-50 mx-2"> > </span>
                    <a href="/user/profile" class="text-white-50">Profile</a>
                    <span class="text-white-50 mx-2"> > </span>
                    <a href="/user/address" class="text-white">Address</a>
                </h5>
            </nav>
            <!-- Breadcrumb -->
        </div>
    </div>

    <section class="pt-3 shadow-lg"> <!-- Added shadow-lg class for a larger shadow -->
        <div class="container">
            <div class="row">
                <div class="col-lg-3 px-3">
                    <div class="account-nav rounded shadow bg-white p-4">
                        <div class="text-center mb-4">
                            <h4 class="mb-0">Hi <%= user.name %></h4>
                            <p class="text-muted">Your personal dashboard</p>
                        </div>
                        <div class="text-center my-3">
                            <a class="nav-link" href="/user/viewCart">
                                <i class="fa-solid fa-wallet me-1"></i>Wallet Amount: <%= user.wallet.toFixed(2) %>
                            </a>
                        </div>
                        <hr>
                        <button class="btn btn-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#navCollapse" aria-expanded="false" aria-controls="navCollapse">
                            Menu
                        </button>
                        <div class="collapse mt-3" id="navCollapse">
                            <ul class="list-unstyled mb-0">
                                <li>
                                    <a href="/user/profile" class="text-decoration-none text-primary d-block py-2">
                                        <button class="btn btn-secondary w-100">Profile</button>
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/address" class="text-decoration-none text-dark d-block py-2">
                                        <button class="btn btn-primary w-100">Address</button>
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/orders" class="text-decoration-none text-dark d-block py-2">
                                        <button class="btn btn-secondary w-100">My Orders</button>
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/viewWishlist" class="text-decoration-none text-dark d-block py-2">
                                        <button class="btn btn-secondary w-100">My Wishlist</button>
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/wallethistory" class="text-decoration-none text-dark d-block py-2">
                                        <button class="btn btn-secondary w-100">Wallet History</button>
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/forgot" class="text-decoration-none text-dark d-block py-2">
                                        <button class="btn btn-secondary w-100">Change Password</button>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>



                <div class="col-lg-9 px-3">
                    <div class="row">
                        <div class="col-md-12 nav-panel p-0">
                            <nav class="nav nav-tabs" id="v-pills-tab" role="tablist">
                                <a class="nav-link active px-5 mx-2" id="v-pills-tab1-tab" data-toggle="pill"
                                    href="#v-pills-tab1" role="tab" aria-controls="v-pills-tab1" aria-selected="true">
                                    Add Address</a>
                                <a class="nav-link px-5 mx-2" id="v-pills-tab2-tab" data-toggle="pill"
                                    href="#v-pills-tab2" role="tab" aria-controls="v-pills-tab2"
                                    aria-selected="false">View Address</a>
                                <a class="nav-link px-5 mx-2" id="v-pills-tab3-tab" data-toggle="pill"
                                    href="#v-pills-tab3" role="tab" aria-controls="v-pills-tab3"
                                    aria-selected="false">Edit Address</a>
                            </nav>
                        </div>
                        <div class="col-md-12">
                            <div class="tab-content" id="v-pills-tabContent">
                                <div class="tab-pane fade show active" id="v-pills-tab1" role="tabpanel"
                                    aria-labelledby="v-pills-tab1-tab">
                                    <h3 class="mt-5 text-center">Add Address</h3>
                                    <form class="my-5" action="/user/addAddress" method="POST">
                                        <!-- User ID input (hidden) -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="hidden" id="formUserId" name="user" class="form-control" />
                                        </div>

                                        <!-- Name input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formName" name="name" class="form-control"
                                                required />
                                            <label class="form-label" for="formName">Name</label>
                                        </div>

                                        <!-- Mobile Number input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formMobileNumber" name="mobileNumber"
                                                class="form-control" required />
                                            <label class="form-label" for="formMobileNumber">Mobile Number</label>
                                        </div>

                                        <!-- Pincode input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formPincode" name="pincode" class="form-control"
                                                required />
                                            <label class="form-label" for="formPincode">Pincode</label>
                                        </div>

                                        <!-- Locality input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formLocality" name="locality" class="form-control"
                                                required />
                                            <label class="form-label" for="formLocality">Locality</label>
                                        </div>

                                        <!-- Address input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formAddress" name="address" class="form-control"
                                                required />
                                            <label class="form-label" for="formAddress">Address</label>
                                        </div>

                                        <!-- District input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formDistrict" name="district" class="form-control"
                                                required />
                                            <label class="form-label" for="formDistrict">District</label>
                                        </div>

                                        <!-- State input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formState" name="state" class="form-control"
                                                required />
                                            <label class="form-label" for="formState">State</label>
                                        </div>

                                        <!-- Landmark input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formLandmark" name="landmark" class="form-control" />
                                            <label class="form-label" for="formLandmark">Landmark</label>
                                        </div>

                                        <!-- Alternate Mobile Number input -->
                                        <div data-mdb-input-init class="form-outline mb-4">
                                            <input type="text" id="formAlternateMobile" name="alternateMobile"
                                                class="form-control" />
                                            <label class="form-label" for="formAlternateMobile">Alternate Mobile
                                                Number</label>
                                        </div>

                                        <!-- Submit button -->
                                        <button data-mdb-ripple-init type="submit"
                                            class="btn btn-primary btn-block mb-4">Add Address</button>
                                    </form>

                                </div>
                                <div class="tab-pane fade" id="v-pills-tab2" role="tabpanel"
                                    aria-labelledby="v-pills-tab2-tab">
                                    <% vilasam.forEach(address=> { %>
                                        <section class="pt-2">
                                            <div class="container h-100">
                                                <div class="row d-flex justify-content-center align-items-center h-100">
                                                    <div class="col col-xl-10">
                                                        <div class="card mb-5" style="border-radius: 15px;">
                                                            <div class="card-body p-4">
                                                                <h3 class="mb-3">
                                                                    <%= address.name %>
                                                                </h3>
                                                                <p><i class="far fa-star fa-lg"></i> <span
                                                                        class="mx-2">|</span>
                                                                    <%= address.address %>, <%= address.locality %>, <%=
                                                                                address.district %>, <%= address.state
                                                                                    %>, <%= address.pincode %>
                                                                </p>
                                                                <hr class="my-4">
                                                                <div
                                                                    class="d-flex justify-content-start align-items-center">
                                                                    <p class="mb-0 text-uppercase"><i
                                                                            class="fas fa-cog me-2"></i> <span
                                                                            class="text-muted small">
                                                                            <%= address.mobileNumber%>
                                                                        </span></p>
                                                                    <span class="ms-3 me-4">|</span></p>
                                                                    <a href="#!">
                                                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/avatar-2.webp"
                                                                            alt="avatar"
                                                                            class="img-fluid rounded-circle me-3"
                                                                            width="35">
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </section>
                                        <% }) %>
                                </div>
                                <div class="tab-pane fade" id="v-pills-tab3" role="tabpanel"
                                    aria-labelledby="v-pills-tab3-tab">
                                    <% vilasam.forEach(address=> { %>
                                        <section class="pt-2">
                                            <div class="container h-100">
                                                <div class="row d-flex justify-content-center align-items-center h-100">
                                                    <div class="col col-xl-10">
                                                        <div class="card mb-5" style="border-radius: 15px;">
                                                            <div class="card-body p-4">
                                                                <h3 class="mb-3">
                                                                    <%= address.name %>
                                                                </h3>
                                                                <p><i class="far fa-star fa-lg"></i> <span
                                                                        class="mx-2">|</span>
                                                                    <%= address.address %>, <%= address.locality %>, <%=
                                                                                address.district %>, <%= address.state
                                                                                    %>, <%= address.pincode %>
                                                                </p>
                                                                <hr class="my-4">
                                                                <div
                                                                    class="d-flex justify-content-between align-items-center">
                                                                    <p class="mb-0 text-uppercase"><i
                                                                            class="fas fa-cog me-2"></i>
                                                                        <span class="text-muted small">
                                                                            <%= address.mobileNumber%>
                                                                        </span>
                                                                        <span class="ms-3 me-4">|</span>
                                                                        <a href="#!">
                                                                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/avatar-2.webp"
                                                                                alt="avatar"
                                                                                class="img-fluid rounded-circle me-3"
                                                                                width="35">
                                                                        </a>
                                                                    </p>
                                                                    <div>
                                                                        <a href="/user/editAddress/<%= address.id%>"><button class="btn btn-sm btn-outline-info"
                                                                            id="editAddress">
                                                                            <i class="bi bi-pencil-square"></i> Edit
                                                                        </button></a>
                                                                        <button class="btn btn-sm delete btn-outline-danger" data-id="<%= address.id %>"
                                                                            id="addressDelete">
                                                                            <i class="bi bi-trash3"></i> Delete
                                                                        </button>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </section>
                                        <% }) %>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>


    </section>

    <script>
        const deleteButtons = document.querySelectorAll(".delete");
        deleteButtons.forEach(function (button) {
            button.addEventListener("click", function () {
                const addressId = this.getAttribute("data-id");
    
                Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(`/user/deleteAddress/${addressId}`, {
                            method: "DELETE"
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (response.ok) {
                                switch (data.message) {
                                    case 'success':
                                        Swal.fire({
                                            title: "Deleted!",
                                            text: "Your address has been deleted.",
                                            icon: "success"
                                        }).then(() => {
                                            window.location.reload();
                                        });
                                        break;
                                    case 'nouser':
                                        Swal.fire({
                                            title: "Failed!",
                                            text: "No user found. Please log in.",
                                            icon: "error"
                                        }).then(()=>{
                                            window.location.href('/user/login?msg=loggin');
                                        })
                                    default:
                                        Swal.fire({
                                            title: "Failed!",
                                            text: "Address cannot be deleted.",
                                            icon: "error"
                                        });
                                }
                            } else {
                                Swal.fire({
                                    title: "Failed!",
                                    text: "Address cannot be deleted.",
                                    icon: "error"
                                });
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                            Swal.fire({
                                title: "Error!",
                                text: "An error occurred while deleting the address.",
                                icon: "error"
                            });
                        });
                    }
                });
            });
        });
    </script>

    <%- include('../../partials/footer') %>